<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seven de Burgers · POS Web</title>
  <link rel="icon" href="data:image/png;base64,iVBORw0KGgo=">
  <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore-compat.js"></script>
  <style>
*{box-sizing:border-box}body{margin:0;background:#0b0b12;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #1b1b24;background:#0d0d16;position:sticky;top:0;z-index:10}
.brand{display:flex;align-items:center;gap:10px}
.logo{width:40px;height:40px;display:grid;place-items:center;background:#ffcc00;color:#0b0b12;font-weight:900;border-radius:8px;box-shadow:0 0 0 3px #222}
.brand-text h1{font-size:18px;line-height:1;margin:0}
.brand-text span{font-size:12px;opacity:.8}
.nav{display:flex;gap:8px}
.tab{background:#151521;color:#ddd;border:1px solid #24243b;border-radius:10px;padding:8px 12px;cursor:pointer}
.tab.active{border-color:#ffcc00;color:#ffcc00}
.userbox{display:flex;gap:8px;align-items:center}
.userbox button{background:#151521;border:1px solid #2a2a3f;color:#ddd;border-radius:8px;padding:6px 10px;cursor:pointer}
.userbox .secondary{opacity:.7}
main{padding:16px}
.view{display:none}.view.visible{display:block}
.grid{display:grid;gap:16px}
.grid.two{grid-template-columns:1fr 1fr}
.grid.three{grid-template-columns:1fr 1fr 1fr}
.card{background:#0f0f19;border:1px solid #202033;border-radius:16px;padding:14px}
.card h2{margin:0 0 10px 0;font-size:18px}
.row{display:flex;gap:10px;align-items:center;margin:8px 0}
.row input,.row textarea,.filters select,.filters input{background:#111120;border:1px solid #23233a;color:#eee;border-radius:10px;padding:8px;flex:1}
.menu-list{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.menu-item{border:1px solid #26263f;background:#0f0f1f;border-radius:12px;padding:10px}
.menu-item h4{margin:0 0 4px 0}
.badge{display:inline-block;font-size:11px;background:#1b1b2e;border:1px solid #2c2c44;color:#a9a9d1;padding:2px 6px;border-radius:999px;margin-right:6px}
.price{color:#ffcc00;font-weight:800}
.btn{background:#17172a;border:1px solid #2a2a46;color:#eee;border-radius:10px;padding:6px 10px;cursor:pointer}
.btn.primary{background:#ffcc00;color:#111;font-weight:800}
.btn.small{font-size:12px;padding:4px 8px}
.order-items{display:flex;flex-direction:column;gap:8px;margin:8px 0}
.order-line{display:flex;justify-content:space-between;gap:8px;background:#131324;border:1px solid #26263f;border-radius:10px;padding:8px}
.order-line .meta{font-size:12px;opacity:.8}
.totals{display:flex;justify-content:space-between;font-weight:800;margin-top:8px}
.actions{display:flex;justify-content:flex-end;gap:8px;margin-top:8px}
.kds-list{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.ticket{background:#101020;border:1px solid #2a2a42;border-radius:14px;padding:10px}
.ticket h4{margin:0 0 6px 0}
.ticket .items{font-size:13px;line-height:1.3}
.status{display:flex;gap:6px;margin-top:8px}
.status button{flex:1}
.muted{opacity:.7}.small{font-size:12px}
.filters{display:flex;gap:8px;margin-bottom:8px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
.modal.visible{display:flex}
.modal-card{background:#0f0f1a;border:1px solid #22223b;border-radius:14px;padding:14px;min-width:320px;max-width:520px}
.extras-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin:8px 0}
.extras-chip{display:flex;justify-content:space-between;align-items:center;border:1px solid #2a2a46;background:#151526;border-radius:10px;padding:6px 8px;font-size:13px}
@media (max-width:980px){.grid.two{grid-template-columns:1fr}.grid.three{grid-template-columns:1fr} .kds-list{grid-template-columns:1fr 1fr} .menu-list{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">7</div>
      <div class="brand-text">
        <h1>SEVEN</h1>
        <span>DE BURGERS</span>
      </div>
    </div>
    <nav class="nav">
      <button id="tabWaiter" class="tab active">Mesero</button>
      <button id="tabKitchen" class="tab">Cocina</button>
      <button id="tabAdmin" class="tab">Admin</button>
    </nav>
    <div class="userbox">
      <span id="userRole">Invitado</span>
      <button id="btnLogin">Entrar</button>
      <button id="btnLogout" class="secondary">Salir</button>
    </div>
  </header>

  <main>
    <section id="viewWaiter" class="view visible">
      <div class="grid two">
        <div class="card">
          <h2>Menú</h2>
          <div class="filters">
            <select id="categoryFilter">
              <option value="all">Todo</option>
              <option value="burgers">Burgers</option>
              <option value="minis">Minis</option>
              <option value="player">Player Select</option>
            </select>
            <input id="searchInput" placeholder="Buscar..." />
          </div>
          <div id="menuList" class="menu-list"></div>
        </div>
        <div class="card">
          <h2>Pedido actual</h2>
          <div class="row">
            <label>Mesa / Cliente</label>
            <input id="orderTable" placeholder="Mesa 1, Para llevar, etc." />
          </div>
          <div id="orderItems" class="order-items"></div>
          <div class="row">
            <label>Comentarios a cocina</label>
            <textarea id="orderNotes" rows="2" placeholder="Sin cebolla, extra salsa, etc."></textarea>
          </div>
          <div class="totals">
            <div>Subtotal: $<span id="subtotal">0</span></div>
            <div>Total: $<span id="total">0</span></div>
          </div>
          <div class="actions">
            <button id="btnClear" class="secondary">Vaciar</button>
            <button id="btnSend" class="primary">Enviar a cocina</button>
          </div>
        </div>
      </div>
    </section>

    <section id="viewKitchen" class="view">
      <div class="card">
        <h2>Órdenes en tiempo real</h2>
        <div id="kdsList" class="kds-list"></div>
      </div>
    </section>

    <section id="viewAdmin" class="view">
      <div class="grid three">
        <div class="card">
          <h2>Menú & Precios</h2>
          <div id="adminMenu"></div>
        </div>
        <div class="card">
          <h2>Inventario</h2>
          <div id="adminInventory"></div>
        </div>
        <div class="card">
          <h2>Finanzas</h2>
          <div class="row">
            <label>Rango:</label>
            <input type="date" id="fromDate">
            <input type="date" id="toDate">
            <button id="btnCalc">Calcular</button>
          </div>
          <div id="financeBox"></div>
          <hr/>
          <h3>Claves de rol</h3>
          <p class="muted">Para prueba sin crear usuarios: introduce PIN por rol.</p>
          <div class="row"><label>Mesero PIN</label><input id="pinWaiter" placeholder="4321"></div>
          <div class="row"><label>Cocina PIN</label><input id="pinKitchen" placeholder="5678"></div>
          <div class="row"><label>Admin PIN</label><input id="pinAdmin" placeholder="9999"></div>
          <button id="btnSavePins">Guardar PINs</button>
        </div>
      </div>
    </section>
  </main>

  <div id="modalExtras" class="modal">
    <div class="modal-card">
      <h3>Personalizar</h3>
      <div id="extrasList"></div>
      <div class="row">
        <label>Notas (opcional)</label>
        <input id="customNotes" placeholder="sin jitomate, etc." />
      </div>
      <div class="actions">
        <button id="btnCancelExtras" class="secondary">Cancelar</button>
        <button id="btnAddExtras" class="primary">Agregar</button>
      </div>
    </div>
  </div>

  <script>
// Tu Firebase (inline)
window.FB_CONFIG = {
  apiKey: "AIzaSyAidr-9HSNlfok5BOBer8Te8EflyV8VYi4",
  authDomain: "seven-de-burgers.firebaseapp.com",
  projectId: "seven-de-burgers",
  storageBucket: "seven-de-burgers.appspot.com",
  messagingSenderId: "34089845279",
  appId: "1:34089845279:web:d13440c34e6bb7fa910b2a",
  measurementId: "G-Q8YQJGL2XY"
};
  </script>

  <script>
// Datos del menú y catálogos
window.MENU = {
  burgers: [
    { id:"b1", name:"Starter Burger", price:47, category:"burgers",
      ingredients:["Pan","Carne","Queso amarillo","Queso blanco","Lechuga","Jitomate","Cebolla"],
      includes:["Mayonesa","Cátsup","Mostaza"], recommendedSauce:null },
    { id:"b2", name:"Koopa Crunch", price:57, category:"burgers",
      ingredients:["Pan","Carne","Queso blanco","Piña","Tocino","Lechuga","Jitomate","Cebolla"],
      includes:["Mayonesa","Cátsup","Mostaza"], recommendedSauce:null },
    { id:"b3", name:"Fatality Flame", price:67, category:"burgers",
      ingredients:["Pan","Carne","Salsa cheddar","Tocino","Salsa habanero","Lechuga","Jitomate","Cebolla"],
      includes:["Mayonesa","Cátsup","Mostaza"], recommendedSauce:"Habanero" },
    { id:"b4", name:"Mega Byte", price:77, category:"burgers",
      ingredients:["Pan","Carne","Salsa cheddar","Queso blanco","Tocino","Salchicha","Lechuga","Jitomate","Cebolla"],
      includes:["Mayonesa","Cátsup"], recommendedSauce:"Cheddar" },
    { id:"b5", name:"Hadouken", price:77, category:"burgers",
      ingredients:["Pan","Carne","Queso blanco","Queso amarillo","Salchicha","Aderezo chipotle","Lechuga","Jitomate","Cebolla"],
      includes:[], recommendedSauce:"Chipotle" },
    { id:"b6", name:"Nintendo Nostalgia", price:67, category:"burgers",
      ingredients:["Pan","Carne","Queso blanco","Piña","Jamón","Lechuga","Jitomate","Cebolla"],
      includes:["Mayonesa","Cátsup","Mostaza"], recommendedSauce:null },
    { id:"b7", name:"Final Boss Burger", price:97, category:"burgers",
      ingredients:["Pan","Carne","Salsa cheddar","Queso blanco","Queso amarillo","Tocino","Jamón","Salchicha","Piña","Salsa habanero","Aderezo chipotle","Lechuga","Jitomate","Cebolla"],
      includes:["Mayonesa","Cátsup","Mostaza"], recommendedSauce:"Habanero/Chipotle" }
  ],
  minis: [
    { id:"m1", name:"Starter Mini", price:27, category:"minis" },
    { id:"m2", name:"Koopa Crunch Mini", price:27, category:"minis" },
    { id:"m3", name:"Fatality Flame Mini", price:37, category:"minis" },
    { id:"m4", name:"Mega Byte Mini", price:37, category:"minis" },
    { id:"m5", name:"Hadouken Mini", price:37, category:"minis" },
    { id:"m6", name:"Nintendo Nostalgia Mini", price:37, category:"minis" },
    { id:"m7", name:"Final Boss Mini", price:47, category:"minis" }
  ],
  playerBase: { id:"p0", name:"Player Select (base)", price:47, category:"player",
    base:["Pan","Carne (85 g)","Queso blanco","Queso amarillo","Lechuga","Jitomate","Cebolla"],
    includes:["Mayonesa","Cátsup","Mostaza"]
  },
  aderezos: [
    { id:"a1", name:"Aderezo de ajo habanero", price:5 },
    { id:"a2", name:"Aderezo chipotle", price:5 },
    { id:"a3", name:"Salsa chimichurri", price:5 },
    { id:"a4", name:"Aderezo cheddar", price:5 },
    { id:"a5", name:"Aderezo de mostaza dulce", price:5 },
    { id:"a6", name:"Aderezo de jalapeño rostizado", price:5 },
    { id:"a7", name:"Aderezo de curry especiado", price:5 },
    { id:"a8", name:"Salsa secreta Seven", price:5 }
  ],
  extras: [
    { id:"e1", name:"Tocino", price:6 },
    { id:"e2", name:"Piña", price:5 },
    { id:"e3", name:"Jamón", price:5 },
    { id:"e4", name:"Salchicha", price:8 },
    { id:"e5", name:"Cebolla caramelizada", price:5 },
    { id:"e6", name:"Queso blanco", price:5 },
    { id:"e7", name:"Queso amarillo", price:5 },
    { id:"e8", name:"Carne extra 85 g", price:17 }
  ]
};
  </script>

  <script>
// App
firebase.initializeApp(window.FB_CONFIG);
const db = firebase.firestore();

let ROLE = localStorage.getItem("role") || "guest";
let CART = [];
let PINS = { waiter:"4321", kitchen:"5678", admin:"9999" };

const qs = s => document.querySelector(s);
const qsa = s => Array.from(document.querySelectorAll(s));
const fmt = n => (Math.round((n + Number.EPSILON)*100)/100).toFixed(0);

function setView(v){
  qsa(".view").forEach(el=>el.classList.remove("visible"));
  qs("#view"+v).classList.add("visible");
  qsa(".tab").forEach(el=>el.classList.remove("active"));
  const id = v==="Waiter"?"#tabWaiter":(v==="Kitchen"?"#tabKitchen":"#tabAdmin");
  qs(id).classList.add("active");
}
qs("#tabWaiter").onclick = ()=> setView("Waiter");
qs("#tabKitchen").onclick = ()=> setView("Kitchen");
qs("#tabAdmin").onclick  = ()=> setView("Admin");

function refreshRoleUI(){
  qs("#userRole").textContent = ROLE.toUpperCase();
  qs("#tabAdmin").style.display = (ROLE==="admin") ? "inline-block" : "none";
  if(ROLE==="kitchen") setView("Kitchen");
  else if(ROLE==="admin") setView("Admin");
  else setView("Waiter");
}
qs("#btnLogin").onclick = async()=>{
  const pin = prompt("PIN (mesero, cocina o admin):");
  // PINS en Firestore (doc: settings/pins) — opcional
  try{
    const sdoc = await db.collection("settings").doc("pins").get();
    const pins = sdoc.exists ? sdoc.data() : PINS;
    if(pin===pins.waiter){ ROLE="waiter"; }
    else if(pin===pins.kitchen){ ROLE="kitchen"; }
    else if(pin===pins.admin){ ROLE="admin"; }
    else { alert("PIN incorrecto"); return; }
    localStorage.setItem("role", ROLE);
    refreshRoleUI();
  }catch(_){
    if(pin===PINS.waiter){ ROLE="waiter"; }
    else if(pin===PINS.kitchen){ ROLE="kitchen"; }
    else if(pin===PINS.admin){ ROLE="admin"; }
    else { alert("PIN incorrecto"); return; }
    localStorage.setItem("role", ROLE);
    refreshRoleUI();
  }
};
qs("#btnLogout").onclick = ()=>{ ROLE="guest"; localStorage.removeItem("role"); refreshRoleUI(); };
refreshRoleUI();

function findItemById(id){
  return window.MENU.burgers.find(b=>b.id===id) ||
         window.MENU.minis.find(m=>m.id===id) ||
        (window.MENU.playerBase.id===id ? window.MENU.playerBase : null);
}

function addToCart(item, custom={}){
  if(!item) return;
  const line = {
    id: Date.now()+"",
    name: item.name,
    baseId: item.id,
    price: item.price + (custom.extrasTotal||0) + (custom.aderezosTotal||0),
    qty: 1,
    extras: custom.extras||[],
    aderezos: custom.aderezos||[],
    notes: custom.notes||""
  };
  CART.push(line);
  refreshCart();
}

function refreshCart(){
  const wrap = qs("#orderItems");
  wrap.innerHTML = "";
  let subtotal = 0;
  CART.forEach(line=>{
    subtotal += line.price*line.qty;
    const div = document.createElement("div");
    div.className="order-line";
    div.innerHTML = `
      <div>
        <div><strong>${line.name}</strong> × ${line.qty} — $ ${fmt(line.price*line.qty)}</div>
        <div class="meta">
          ${line.aderezos.length? 'Aderezos: '+line.aderezos.join(', ')+'; ': ''}
          ${line.extras.length? 'Extras: '+line.extras.join(', ')+'; ': ''}
          ${line.notes? 'Notas: '+line.notes: ''}
        </div>
      </div>
      <div>
        <button class="btn small secondary" data-id="${line.id}">Quitar</button>
      </div>
    `;
    wrap.appendChild(div);
  });
  qs("#subtotal").textContent = fmt(subtotal);
  qs("#total").textContent = fmt(subtotal);
  wrap.querySelectorAll("button").forEach(b=>{
    b.onclick = ()=>{
      CART = CART.filter(l=>l.id!==b.getAttribute("data-id"));
      refreshCart();
    };
  });
}
qs("#btnClear").onclick = ()=>{ CART=[]; refreshCart(); };

qs("#btnSend").onclick = async()=>{
  if(!CART.length){ alert("Agrega productos al pedido"); return; }
  const table = qs("#orderTable").value || "Mostrador";
  const notes = qs("#orderNotes").value || "";
  const total = Number(qs("#total").textContent);
  const order = {
    table, notes, items: CART, total,
    status:"pending",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  };
  try{
    await db.collection("orders").add(order);
    CART = []; refreshCart(); qs("#orderNotes").value=""; qs("#orderTable").value="";
    alert("Pedido enviado a cocina ✅");
  }catch(e){
    alert("Error al enviar: " + e.message);
  }
};

function openExtrasModal(){
  const m = qs("#modalExtras");
  const box = qs("#extrasList");
  box.innerHTML = "";
  const makeSection = (title, list)=>{
    const el = document.createElement("div");
    el.innerHTML = "<h4>"+title+"</h4>";
    const grid = document.createElement("div");
    grid.className="extras-grid";
    list.forEach(it=>{
      const row = document.createElement("div");
      row.className="extras-chip";
      row.innerHTML = `<span>${it.name}</span><span>$ ${it.price}</span><input type="checkbox" data-id="${it.id}" data-name="${it.name}" data-price="${it.price}"/>`;
      grid.appendChild(row);
    });
    el.appendChild(grid);
    box.appendChild(el);
  };
  makeSection("Aderezos (+$5 c/u)", window.MENU.aderezos);
  makeSection("Extras", window.MENU.extras);
  m.classList.add("visible");

  qs("#btnCancelExtras").onclick = ()=> m.classList.remove("visible");
  qs("#btnAddExtras").onclick = ()=>{
    const checks = box.querySelectorAll("input[type=checkbox]:checked");
    const ad = []; const ex = []; let adTotal=0, exTotal=0;
    checks.forEach(ch=>{
      const id = ch.getAttribute("data-id");
      const nm = ch.getAttribute("data-name");
      const pr = Number(ch.getAttribute("data-price"));
      if(id.startsWith("a")){ ad.push(nm); adTotal+=pr; } else { ex.push(nm); exTotal+=pr; }
    });
    const notes = qs("#customNotes").value;
    addToCart(window.MENU.playerBase, { aderezos:ad, extras:ex, aderezosTotal:adTotal, extrasTotal:exTotal, notes });
    qs("#customNotes").value=""; m.classList.remove("visible");
  };
}

function renderMenu(){
  const list = qs("#menuList");
  list.innerHTML = "";
  const term = qs("#searchInput").value.toLowerCase();
  const cat  = qs("#categoryFilter").value;

  const addCard = (item, type)=>{
    const div = document.createElement("div");
    div.className = "menu-item";
    div.innerHTML = `
      <h4>${item.name} <span class="price">$ ${item.price}</span></h4>
      <div class="badges"><span class="badge">${type}</span></div>
      <div class="muted small">${(item.ingredients||[]).join(", ")}</div>
      <div style="margin-top:6px;display:flex;gap:6px">
        <button class="btn small" data-id="${item.id}" data-type="${type}">Agregar</button>
        ${type==="player" ? '<button class="btn small" data-id="'+item.id+'" data-type="player-custom">Personalizar</button>' : ''}
      </div>`;
    list.appendChild(div);
  };

  window.MENU.burgers
    .filter(b => (cat==="all"||cat==="burgers"))
    .filter(b => b.name.toLowerCase().includes(term))
    .forEach(b => addCard(b, "burger"));

  window.MENU.minis
    .filter(m => (cat==="all"||cat==="minis"))
    .filter(m => m.name.toLowerCase().includes(term))
    .forEach(m => addCard(m, "mini"));

  if(cat==="all" || cat==="player"){
    addCard(window.MENU.playerBase, "player");
  }

  list.querySelectorAll("button").forEach(btn=>{
    btn.onclick = ()=>{
      const id   = btn.getAttribute("data-id");
      const type = btn.getAttribute("data-type");
      if(type==="player-custom"){
        openExtrasModal();
      }else{
        addToCart(findItemById(id));
      }
    };
  });
}
qs("#categoryFilter").onchange = renderMenu;
qs("#searchInput").oninput = renderMenu;

function listenKDS(){
  db.collection("orders").orderBy("createdAt","desc").limit(30).onSnapshot(snap=>{
    const wrap = qs("#kdsList");
    wrap.innerHTML="";
    snap.docs.forEach(doc=>{
      const o = { id:doc.id, ...doc.data() };
      const div = document.createElement("div");
      div.className="ticket";
      const itemsHtml = o.items.map(i=>{
        const parts = [
          "<strong>"+i.name+"</strong> × "+i.qty,
          i.aderezos?.length? "Aderezos: "+i.aderezos.join(", ") : null,
          i.extras?.length? "Extras: "+i.extras.join(", ") : null,
          i.notes? "Notas: "+i.notes : null
        ].filter(Boolean).join("<br/>");
        return "<div class='items'>"+parts+"</div>";
      }).join("<hr/>");
      div.innerHTML = `
        <h4>Mesa: ${o.table} — <span class="muted">${o.status}</span></h4>
        ${itemsHtml}
        <div class="status">
          <button data-st="pending">Pendiente</button>
          <button data-st="in_progress">En proceso</button>
          <button data-st="ready">Listo</button>
          <button data-st="delivered">Entregado</button>
        </div>`;
      div.querySelectorAll(".status button").forEach(b=>{
        b.onclick = async()=>{
          await db.collection("orders").doc(o.id).update({ status:b.getAttribute("data-st") });
        };
      });
      wrap.appendChild(div);
    });
  });
}
listenKDS();

function renderAdminMenu(){
  const box = qs("#adminMenu");
  box.innerHTML = "";
  ["burgers","minis"].forEach(cat=>{
    const title = document.createElement("h4"); title.textContent = cat.toUpperCase();
    box.appendChild(title);
    window.MENU[cat].forEach(it=>{
      const row = document.createElement("div");
      row.className="row";
      row.innerHTML = `<span style="flex:2">${it.name}</span><input style="max-width:120px" type="number" value="${it.price}" data-id="${it.id}" /><span>$</span>`;
      box.appendChild(row);
    });
  });
  const save = document.createElement("button");
  save.className="btn"; save.textContent="Guardar precios";
  save.onclick = ()=>{
    document.querySelectorAll("#adminMenu input").forEach(inp=>{
      const id = inp.getAttribute("data-id");
      const val= Number(inp.value);
      let obj = window.MENU.burgers.find(x=>x.id===id) || window.MENU.minis.find(x=>x.id===id);
      if(obj){ obj.price = val; }
    });
    alert("Precios actualizados (solo en esta sesión).");
  };
  box.appendChild(save);
}
function renderInventory(){
  const box = qs("#adminInventory");
  box.innerHTML = "<p class='muted small'>Inventario básico demo (puedo conectarlo a Firestore luego).</p>";
  const wrap = document.createElement("div");
  wrap.className="order-items";
  box.appendChild(wrap);
  const items = [
    {name:"Pan burger", unit:"pza", stock:30, min:12},
    {name:"Carne 85 g", unit:"pza", stock:50, min:20},
    {name:"Queso amarillo", unit:"reb", stock:80, min:30},
    {name:"Queso blanco", unit:"reb", stock:80, min:30}
  ];
  items.forEach(it=>{
    const line=document.createElement("div"); line.className="row";
    const warn = it.stock<=it.min? "<span class='badge' style='border-color:#ff5b5b;color:#ff5b5b'>Bajo</span>":"";
    line.innerHTML = `<span style="flex:2">${it.name} (${it.unit})</span><span>Stock: ${it.stock}</span><span>Min: ${it.min}</span>${warn}`;
    wrap.appendChild(line);
  });
}
async function calcFinance(){
  const from = qs("#fromDate").value ? new Date(qs("#fromDate").value) : new Date(new Date().toDateString());
  const to   = qs("#toDate").value ? new Date(qs("#toDate").value+" 23:59") : new Date();
  const snap = await db.collection("orders").where("createdAt",">=",from).where("createdAt","<=",to).get();
  let revenue=0, orders=0;
  snap.forEach(d=>{ orders++; revenue += (d.data().total||0); });
  const box = qs("#financeBox");
  box.innerHTML = `
    <div class="order-line"><div>Órdenes</div><div>${orders}</div></div>
    <div class="order-line"><div>Ingresos estimados</div><div>$ ${fmt(revenue)}</div></div>
    <p class="muted small">Para costos/utilidad, añadimos COGS por producto en Firestore más adelante.</p>`;
}
qs("#btnCalc").onclick = calcFinance;

function renderAll(){ renderMenu(); renderAdminMenu(); renderInventory(); }
renderAll();
  </script>
</body>
</html>

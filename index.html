<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Seven de Burgers · POS v6.6</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore-compat.js"></script>
  <style>
    :root { --bg:#0e0f13; --panel:#161924; --text:#f2f2f6; --muted:#9aa0aa; --accent:#ffd54a; }
    * { box-sizing:border-box; }
    body { margin:0; color:var(--text); background:#0a0b10; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    header{ display:flex; align-items:center; justify-content:space-between; padding:14px 18px; background:#0f1320; border-bottom:1px solid #1f2333; position:sticky; top:0; z-index:20; }
    .brand{ display:flex; gap:12px; align-items:center; font-weight:800; letter-spacing:.3px; }
    .brand .logo{ width:44px; height:44px; display:grid; place-items:center; border-radius:10px; background:#1a2245; border:1px solid #232a45; font-family:"Press Start 2P"; color:var(--accent);}
    .tabs{ display:flex; gap:8px; }
    .tab{ padding:10px 12px; border-radius:10px; background:#121524; border:1px solid #22273b; cursor:pointer; font-weight:600; color:var(--muted);}
    .tab.active{ background:#171b2e; color:var(--text); border-color:#2b3152; }
    .main{ padding:18px; display:grid; gap:16px; max-width:1100px; margin:0 auto; }
    .panel{ background:#101427; border:1px solid #1c2340; border-radius:14px; padding:16px; }
    .title{ font-weight:800; letter-spacing:.3px; margin:0 0 12px 0; }
    .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(280px,1fr)); gap:12px; }
    .btn{ background:#1a2146; border:1px solid #283060; color:var(--text); padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700; letter-spacing:.3px; }
    .btn:hover{ filter:brightness(1.05); }
    .btn.primary{ background:#2a3c8a; border-color:#31469c; }
    .btn.success{ background:#1f5b3a; border-color:#2c7a52; }
    .btn.warn{ background:#7a4a14; border-color:#a9651c; }
    .muted{ color:var(--muted); }
    input, select, textarea{ width:100%; background:#0e1326; color:var(--text); border:1px solid #1d2342; border-radius:10px; padding:10px; outline:none; font:inherit; }
    textarea{ min-height:80px; }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .row > *{ flex:1; min-width:200px; }
    .order-card{ border:1px solid #233056; border-radius:12px; padding:12px; background:#121935; display:grid; gap:8px; }
    .pill{ padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid #2b325a; color:#c9d1ff; width:max-content; }
    .status-pending{ background:#261721; }
    .status-prep{ background:#202a18; }
    .status-ready{ background:#1a2133; }
    .small{ font-size:12px; }
    footer{ text-align:center; padding:18px; color:#8087a0; }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">7</div>
      <div>
        <div style="font-family:'Press Start 2P'; font-size:13px; line-height:1;">SEVEN DE BURGERS</div>
        <div class="small muted">POS v6.6 · Mesas / Cocina en tiempo real</div>
      </div>
    </div>
    <div class="tabs">
      <div class="tab active" id="tab-waiter">Mesero</div>
      <div class="tab" id="tab-kitchen">Cocina</div>
    </div>
  </header>

  <main class="main">
    <section class="panel" id="identity">
      <h3 class="title">Identifícate</h3>
      <div class="row">
        <div><label>Nombre del mesero</label><input id="waiterName" placeholder="Ej. Alex" /></div>
        <div><label>Mesa por defecto</label><select id="defaultTable"><option value="">—</option><option value="1">Mesa 1</option><option value="2">Mesa 2</option><option value="3">Mesa 3</option><option value="4">Mesa 4</option><option value="5">Mesa 5</option><option value="6">Mesa 6</option><option value="7">Mesa 7</option><option value="8">Mesa 8</option><option value="9">Mesa 9</option><option value="10">Mesa 10</option><option value="11">Mesa 11</option><option value="12">Mesa 12</option></select></div>
        <div><label>PIN (opcional)</label><input id="pin" placeholder="4321 mesero / 5678 cocina" /></div>
      </div>
      <div style="display:flex; gap:10px; margin-top:10px;">
        <button class="btn primary" id="saveIdentity">Guardar</button>
        <div class="muted small">Se guarda en este navegador.</div>
      </div>
    </section>

    <section class="panel" id="waiterView">
      <h3 class="title">Crear pedido</h3>
      <div class="row">
        <div><label>Mesa</label><select id="mesaSelect"><option value="">Selecciona mesa</option><option value="1">Mesa 1</option><option value="2">Mesa 2</option><option value="3">Mesa 3</option><option value="4">Mesa 4</option><option value="5">Mesa 5</option><option value="6">Mesa 6</option><option value="7">Mesa 7</option><option value="8">Mesa 8</option><option value="9">Mesa 9</option><option value="10">Mesa 10</option><option value="11">Mesa 11</option><option value="12">Mesa 12</option></select></div>
        <div><label>Hamburguesa</label><select id="burgerSelect"><option value="">Selecciona</option><option value="starter">Starter Burger · $47</option><option value="koopa">Koopa Crunch · $57</option><option value="fatality">Fatality Flame · $67</option><option value="megabyte">Mega Byte · $77</option><option value="hadouken">Hadouken · $77</option><option value="nintendo">Nintendo Nostalgia · $67</option><option value="finalboss">Final Boss Burger · $97</option><option value="player">Player Select (arma tu burger)</option></select></div>
      </div>

      <div id="playerExtras" style="display:none; margin-top:10px;">
        <div class="muted small" style="margin-bottom:6px;">Extras (Player Select):</div>
        <div class="grid" id="extrasGrid"></div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div><label>¿Agregar salsa sugerida?</label>
          <select id="salsaSugerida"><option value="no">No</option><option value="si">Sí</option></select>
        </div>
        <div><label>Salsa elegida (si el cliente pide otra)</label>
          <select id="salsaElegida"><option value="">—</option><option>Ajo & Habanero</option><option>Chipotle</option><option>Chimichurri (León, Gto.)</option><option>Cheddar</option><option>Mostaza dulce</option><option>Jalapeño rostizado</option><option>Curry Seven</option><option>BBQ tamarindo</option></select>
        </div>
      </div>

      <div style="margin-top:10px;">
        <label>Notas para cocina (omitir/añadir — Ej: sin jitomate)</label>
        <textarea id="notas"></textarea>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px;">
        <button class="btn success" id="enviarPedido">Enviar a cocina</button>
        <button class="btn" id="limpiar">Limpiar</button>
      </div>
    </section>

    <section class="panel" id="myOrders">
      <h3 class="title">Mis pedidos</h3>
      <div id="misPedidosGrid" class="grid"></div>
    </section>

    <section class="panel" id="kitchenView" style="display:none;">
      <h3 class="title">Cocina · Pedidos en tiempo real</h3>
      <div class="row" style="margin-bottom:8px;">
        <div><label>Filtro por mesa</label><input id="kitchenFilterMesa" placeholder="Ej. 4" /></div>
        <div><label>Estado</label><select id="kitchenFilterEstado"><option value="">Todos</option><option value="pendiente">Pendiente</option><option value="preparando">Preparando</option><option value="listo">Listo</option></select></div>
      </div>
      <div id="kitchenGrid" class="grid"></div>
    </section>
  </main>

  <footer class="small" style="text-align:center; padding:16px; color:#8a92ad;">© 2025 Seven de Burgers · v6.6</footer>

  <script>
    const firebaseConfig = {"apiKey": "AIzaSyAidr-9HSNlfok5BOBer8Te8EflyV8VYi4", "authDomain": "seven-de-burgers.firebaseapp.com", "projectId": "seven-de-burgers", "storageBucket": "seven-de-burgers.firebasestorage.app", "messagingSenderId": "34089845279", "appId": "1:34089845279:web:d13440c34e6bb7fa910b2a", "measurementId": "G-Q8YQJGL2XY"};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const state = {
      waiterName: localStorage.getItem('waiterName') || '',
      defaultTable: localStorage.getItem('defaultTable') || '',
      pin: localStorage.getItem('pin') || '',
      role: 'waiter',
      burgers: [{"id": "starter", "name": "Starter Burger", "price": 47, "ingredients": ["Pan", "Carne (85g)", "Queso amarillo", "Queso blanco", "Lechuga", "Jitomate", "Cebolla", "Mayonesa", "C\u00e1tsup", "Mostaza"], "salsaSugerida": null}, {"id": "koopa", "name": "Koopa Crunch", "price": 57, "ingredients": ["Pan", "Carne (85g)", "Queso blanco", "Pi\u00f1a", "Tocino", "Lechuga", "Jitomate", "Cebolla", "Mayonesa", "C\u00e1tsup", "Mostaza"], "salsaSugerida": "Mostaza dulce"}, {"id": "fatality", "name": "Fatality Flame", "price": 67, "ingredients": ["Pan", "Carne (85g)", "Salsa cheddar", "Tocino", "Salsa habanero", "Lechuga", "Jitomate", "Cebolla", "Mayonesa", "C\u00e1tsup", "Mostaza"], "salsaSugerida": "Habanero"}, {"id": "megabyte", "name": "Mega Byte", "price": 77, "ingredients": ["Pan", "Carne (85g)", "Salsa cheddar", "Queso blanco", "Tocino", "Salchicha", "Lechuga", "Jitomate", "Cebolla", "Mayonesa", "C\u00e1tsup", "Mostaza"], "salsaSugerida": "BBQ tamarindo"}, {"id": "hadouken", "name": "Hadouken", "price": 77, "ingredients": ["Pan", "Carne (85g)", "Queso blanco", "Queso amarillo", "Salchicha", "Aderezo chipotle", "Lechuga", "Jitomate", "Cebolla", "C\u00e1tsup", "Mostaza"], "salsaSugerida": "Chipotle"}, {"id": "nintendo", "name": "Nintendo Nostalgia", "price": 67, "ingredients": ["Pan", "Carne (85g)", "Queso blanco", "Pi\u00f1a", "Jam\u00f3n", "Lechuga", "Jitomate", "Cebolla", "Mayonesa", "C\u00e1tsup", "Mostaza"], "salsaSugerida": "Mostaza dulce"}, {"id": "finalboss", "name": "Final Boss Burger", "price": 97, "ingredients": ["Pan", "Carne (85g)", "Salsa cheddar", "Queso blanco", "Queso amarillo", "Tocino", "Jam\u00f3n", "Salchicha", "Pi\u00f1a", "Salsa habanero", "Aderezo chipotle", "Lechuga", "Jitomate", "Cebolla", "C\u00e1tsup", "Mayonesa", "Mostaza"], "salsaSugerida": "Curry Seven"}],
      extras: [{"name": "Tocino", "price": 6}, {"name": "Pi\u00f1a", "price": 5}, {"name": "Salsa habanero", "price": 3}, {"name": "Salsa chimichurri", "price": 4}, {"name": "Jam\u00f3n", "price": 5}, {"name": "Salchicha", "price": 8}, {"name": "Salsa cheddar", "price": 3}],
      salsas: ["Ajo & Habanero", "Chipotle", "Chimichurri (Le\u00f3n, Gto.)", "Cheddar", "Mostaza dulce", "Jalape\u00f1o rostizado", "Curry Seven", "BBQ tamarindo"]
    };

    const waiterNameEl = document.getElementById('waiterName');
    const defaultTableEl = document.getElementById('defaultTable');
    const pinEl = document.getElementById('pin');
    const saveIdentityBtn = document.getElementById('saveIdentity');

    const tabWaiter = document.getElementById('tab-waiter');
    const tabKitchen = document.getElementById('tab-kitchen');
    const waiterView = document.getElementById('waiterView');
    const kitchenView = document.getElementById('kitchenView');

    const mesaSelect = document.getElementById('mesaSelect');
    const burgerSelect = document.getElementById('burgerSelect');
    const playerExtras = document.getElementById('playerExtras');
    const extrasGrid = document.getElementById('extrasGrid');
    const salsaSugeridaEl = document.getElementById('salsaSugerida');
    const salsaElegidaEl = document.getElementById('salsaElegida');
    const notasEl = document.getElementById('notas');
    const enviarPedido = document.getElementById('enviarPedido');
    const limpiarBtn = document.getElementById('limpiar');
    const misPedidosGrid = document.getElementById('misPedidosGrid');

    const kitchenFilterMesa = document.getElementById('kitchenFilterMesa');
    const kitchenFilterEstado = document.getElementById('kitchenFilterEstado');
    const kitchenGrid = document.getElementById('kitchenGrid');

    waiterNameEl.value = state.waiterName;
    defaultTableEl.value = state.defaultTable;
    pinEl.value = state.pin;
    if (!mesaSelect.value && state.defaultTable) mesaSelect.value = state.defaultTable;

    function activateTab(which){
      if(which==='waiter') {
        tabWaiter.classList.add('active');
        tabKitchen.classList.remove('active');
        waiterView.style.display='block';
        kitchenView.style.display='none';
      } else {
        tabKitchen.classList.add('active');
        tabWaiter.classList.remove('active');
        kitchenView.style.display='block';
        waiterView.style.display='none';
      }
    }
    tabWaiter.onclick = () => activateTab('waiter');
    tabKitchen.onclick = () => activateTab('kitchen');

    saveIdentityBtn.onclick = () => {
      state.waiterName = waiterNameEl.value.trim() || 'Mesero';
      state.defaultTable = defaultTableEl.value;
      state.pin = pinEl.value.trim();
      localStorage.setItem('waiterName', state.waiterName);
      localStorage.setItem('defaultTable', state.defaultTable);
      localStorage.setItem('pin', state.pin);
      state.role = (state.pin==='5678') ? 'kitchen' : 'waiter';
      activateTab(state.role==='kitchen'?'kitchen':'waiter');
      subscribeMyOrders();
      subscribeKitchen();
      alert('Identidad guardada');
    };

    function renderExtras(){
      extrasGrid.innerHTML='';
      state.extras.forEach((ex,idx)=>{
        const id = 'ex_'+idx;
        const div = document.createElement('div');
        div.className='order-card';
        div.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
            <div><strong>${ex.name}</strong></div>
            <label class="small muted">+${ex.price}</label>
          </div>
          <div class="row" style="align-items:center;">
            <label class="small muted" style="flex:0 0 auto;">Agregar</label>
            <input type="checkbox" id="${id}" />
          </div>`;
        extrasGrid.appendChild(div);
      });
    }
    renderExtras();

    burgerSelect.onchange = () => {
      const val = burgerSelect.value;
      playerExtras.style.display = (val==='player') ? 'block' : 'none';
      const b = state.burgers.find(x=>x.id===val);
      if(b && b.salsaSugerida) salsaSugeridaEl.value = 'si'; else salsaSugeridaEl.value='no';
    };

    limpiarBtn.onclick = () => {
      burgerSelect.value='';
      playerExtras.style.display='none';
      Array.from(extrasGrid.querySelectorAll('input[type=checkbox]')).forEach(ch=>ch.checked=false);
      salsaSugeridaEl.value='no';
      salsaElegidaEl.value='';
      notasEl.value='';
    };

    function nowTs(){ return Date.now(); }
    function getSelectedExtras(){
      const out=[];
      Array.from(extrasGrid.querySelectorAll('input[type=checkbox]')).forEach((ch,idx)=>{
        if(ch.checked) out.push(state.extras[idx]);
      });
      return out;
    }

    enviarPedido.onclick = async () => {
      const mesa = (mesaSelect.value || state.defaultTable || '').trim();
      const burgerId = burgerSelect.value;
      if(!mesa || !burgerId){ alert('Selecciona mesa y hamburguesa'); return; }
      const waiter = state.waiterName || 'Mesero';
      const base = state.burgers.find(x=>x.id===burgerId);
      let itemName = '';
      let price = 0;
      let ingredientes = [];
      let salsaSugerida = base ? (base.salsaSugerida || null) : null;

      if(burgerId==='player'){
        itemName = 'Player Select';
        price = 47 + getSelectedExtras().reduce((a,b)=>a+b.price,0);
        ingredientes = [
          'Base: Pan, Carne (85g), Queso amarillo, Queso blanco, Lechuga, Jitomate, Cebolla',
          ...getSelectedExtras().map(e=>'Extra: '+e.name)
        ];
      } else {
        itemName = base.name;
        price = base.price;
        ingredientes = base.ingredients;
      }

      const quiereSalsaSugerida = (salsaSugeridaEl.value==='si');
      const salsaElegida = salsaElegidaEl.value || null;
      const notas = (notasEl.value||'').trim();

      const payload = {
        mesa, waiter, itemName, burgerId, price, ingredientes,
        salsaSugerida: salsaSugerida || null,
        quiereSalsaSugerida,
        salsaElegida,
        notas,
        status:'pendiente',
        createdAt: nowTs()
      };
      try {
        await db.collection('orders').add(payload);
        alert('Pedido enviado a cocina');
        limpiarBtn.click();
      } catch(e){
        console.error(e);
        alert('Error al enviar pedido');
      }
    };

    let unsubMy = null;
    function subscribeMyOrders(){
      if(unsubMy) unsubMy();
      const waiter = state.waiterName || 'Mesero';
      unsubMy = db.collection('orders')
        .where('waiter','==',waiter)
        .orderBy('createdAt','desc')
        .onSnapshot(snap=>{
          misPedidosGrid.innerHTML='';
          snap.forEach(doc=>{
            const d=doc.data();
            if(d.status==='entregado') return;
            const card = document.createElement('div');
            card.className='order-card';
            card.innerHTML = `
              <div class="row" style="justify-content:space-between;">
                <div><span class="pill">Mesa ${d.mesa}</span></div>
                <div class="small muted">${new Date(d.createdAt).toLocaleTimeString()}</div>
              </div>
              <div><strong>${d.itemName}</strong> <span class="muted">· $${d.price}</span></div>
              <div class="small muted">Ingredientes: ${(Array.isArray(d.ingredientes)?d.ingredientes.join(', '):d.ingredientes)}</div>
              <div class="small">Salsa sugerida: <strong>${(d.salsaSugerida || '—')}</strong> · Cliente ${(d.quiereSalsaSugerida?'SÍ':'NO')}</div>
              <div class="small">Salsa elegida: <strong>${(d.salsaElegida || '—')}</strong></div>
              <div class="small">Notas: <em>${(d.notas || '—')}</em></div>
              <div class="row" style="margin-top:6px; gap:8px;">
                <div class="pill ${(d.status==='pendiente'?'status-pending': d.status==='preparando'?'status-prep':'status-ready')}">Estado: ${d.status}</div>
                <button class="btn warn" data-act="preparando">Marcar preparando</button>
                <button class="btn success" data-act="listo">Marcar listo</button>
                <button class="btn" data-act="entregado">Marcar entregado</button>
              </div>`;
            card.querySelectorAll('button').forEach(b=>{
              b.onclick = async () => { await db.collection('orders').doc(doc.id).update({status:b.dataset.act}); }
            });
            misPedidosGrid.appendChild(card);
          });
        });
    }
    subscribeMyOrders();

    let unsubK = null;
    function renderKitchen(docId, d){
      const card = document.createElement('div');
      card.className='order-card';
      const ingredientes = Array.isArray(d.ingredientes) ? d.ingredientes : [d.ingredientes];
      card.innerHTML = `
        <div class="row" style="justify-content:space-between;">
          <div><span class="pill">Mesa ${d.mesa}</span> · <span class="small muted">${d.waiter}</span></div>
          <div class="small muted">${new Date(d.createdAt).toLocaleTimeString()}</div>
        </div>
        <div><strong style="color:var(--accent)">${d.itemName}</strong> <span class="muted">· $${d.price}</span></div>
        <div class="small">Salsa sugerida: <strong>${(d.salsaSugerida || '—')}</strong> · Cliente ${(d.quiereSalsaSugerida?'SÍ':'NO')}</div>
        <div class="small">Salsa elegida: <strong>${(d.salsaElegida || '—')}</strong></div>
        <div class="small muted">Ingredientes:</div>
        <ul class="small" style="margin:0 0 6px 18px;">${ingredientes.map(x=>`<li>${x}</li>`).join('')}</ul>
        <div class="small">Notas: <em>${(d.notas || '—')}</em></div>
        <div class="row" style="margin-top:8px; gap:8px;">
          <div class="pill ${(d.status==='pendiente'?'status-pending': d.status==='preparando'?'status-prep':'status-ready')}">Estado: ${d.status}</div>
          <button class="btn warn" data-act="preparando">Preparando</button>
          <button class="btn success" data-act="listo">Listo</button>
          <button class="btn" data-act="entregado">Entregado</button>
        </div>`;
      card.querySelectorAll('button').forEach(b=>{
        b.onclick = async () => { await db.collection('orders').doc(docId).update({status:b.dataset.act}); }
      });
      return card;
    }

    function subscribeKitchen(){
      if(unsubK) unsubK();
      unsubK = db.collection('orders').orderBy('createdAt','desc').onSnapshot(snap=>{
        const mesaFilter = (kitchenFilterMesa.value||'').trim();
        const estFilter = kitchenFilterEstado.value;
        kitchenGrid.innerHTML='';
        snap.forEach(doc=>{
          const d=doc.data();
          if(d.status==='entregado') return;
          if(mesaFilter && String(d.mesa)!==mesaFilter) return;
          if(estFilter && d.status!==estFilter) return;
          kitchenGrid.appendChild(renderKitchen(doc.id, d));
        });
      });
    }
    subscribeKitchen();
    kitchenFilterMesa.oninput = subscribeKitchen;
    kitchenFilterEstado.onchange = subscribeKitchen;
  </script>
</body>
</html>

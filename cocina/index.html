<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover, interactive-widget=resizes-content"/>
  <meta name="theme-color" content="#0b1220"/>
  <meta name="color-scheme" content="dark light"/>
  <title>Cocina — Seven de Burgers</title>

  <link rel="icon" href="../favicon.ico">
  <link rel="preload" as="style" href="../shared/styles.css?v=20251105"/>
  <link rel="stylesheet" href="../shared/styles.css?v=20251105">

  <!-- Acelera la carga de módulos que usa app.js -->
  <link rel="modulepreload" href="../shared/db.js?v=20251105">
  <link rel="modulepreload" href="../shared/notify.js?v=20251105">
  <link rel="modulepreload" href="../shared/theme.js?v=20251105">

  <!-- Parche anti “saltos” de scroll y viewport inestable -->
  <style>
    html, body {
      height: 100%;
      overscroll-behavior-y: contain;
      scroll-behavior: auto !important;
    }
    :root { --vh: 1vh; }
    .shell, .container { min-height: calc(var(--vh, 1vh) * 100); }

    /* Cada columna actúa como límite de layout/paint y evita reflujo global */
    .k-col {
      contain: layout paint;
      overflow-anchor: none;
      will-change: contents;
      min-height: 40vh;
    }
    /* El contenedor principal no cambia de tamaño por errores de layout */
    .k-columns { contain: layout; }
    /* Tarjetas contenidas, evita repintado global */
    .k-card { contain: content; }
  </style>

  <script>
    // Fija --vh al alto real visible (para evitar saltos en móviles)
    function setVH(){
      const h = (window.visualViewport?.height || window.innerHeight) * 0.01;
      document.documentElement.style.setProperty('--vh', h + 'px');
    }
    setVH();
    window.addEventListener('resize', setVH, { passive:true });
    window.addEventListener('orientationchange', setVH, { passive:true });
  </script>
</head>

<body class="shell" data-app="cocina">
  <noscript>
    <div style="padding:12px;background:#300;color:#fff;text-align:center">
      Necesitas habilitar JavaScript para usar el panel de cocina.
    </div>
  </noscript>

  <div class="container" role="main" id="appRoot">
    <div class="row" style="margin-bottom:10px">
      <a class="badge" href="../kiosk/">Kiosko</a>
      <div class="right badge" aria-current="page">Cocina</div>
    </div>

    <div id="live-region" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

    <div class="k-columns">
      <div class="card">
        <h2>Pendientes</h2>
        <div id="col-pending" class="col k-col" aria-label="Órdenes pendientes"></div>
      </div>

      <div class="card">
        <h2>En preparación</h2>
        <div id="col-progress" class="col k-col" aria-label="Órdenes en preparación"></div>
      </div>

      <div class="card">
        <h2>Listos</h2>
        <div id="col-ready" class="col k-col" aria-label="Órdenes listas para entregar"></div>
      </div>

      <div class="card">
        <h2>Por cobrar</h2>
        <div id="col-bill" class="col k-col" aria-label="Órdenes por cobrar"></div>
      </div>
    </div>
  </div>

  <!-- ====== RUTA MODERNA (ESM) ====== -->
  <script type="module" src="./app.js?v=20251105"></script>

  <!-- ====== LEGACY (sin módulos) ====== -->
  <!-- Polyfills mínimos para iOS viejito -->
  <script nomodule src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"></script>
  <script nomodule src="https://cdn.jsdelivr.net/npm/whatwg-fetch@3/dist/fetch.umd.js"></script>
  <script nomodule>
    (function(){
      if(!window.console){
        window.console = {};
        ["log","warn","error","info"].forEach(function(m){ console[m] = function(){}; });
      }
    })();
    if (!Element.prototype.closest) {
      Element.prototype.closest = function(s) {
        var el = this; if(!document.documentElement.contains(el)) return null;
        do { if(el.matches && el.matches(s)) return el; el = el.parentElement || el.parentNode; }
        while (el && el.nodeType === 1);
        return null;
      };
    }
    if (window.NodeList && !NodeList.prototype.forEach) {
      NodeList.prototype.forEach = Array.prototype.forEach;
    }
    if (!Object.assign) Object.assign = function(t){
      for(var i=1;i<arguments.length;i++){
        var s=arguments[i]||{};
        for(var k in s){ if(Object.prototype.hasOwnProperty.call(s,k)) t[k]=s[k]; }
      }
      return t;
    };
    if (!String.prototype.includes) {
      String.prototype.includes = function(s, i){ return this.indexOf(s, i||0) !== -1; };
    }
  </script>

  <!-- Libs/DB en modo legacy (solo navegadores sin módulos) -->
  <script nomodule src="../shared/compat.js?v=20251105"></script>
  <script nomodule src="../shared/notify.legacy.js?v=20251105"></script>
  <script nomodule src="../shared/db.legacy.js?v=20251105"></script>
  <script nomodule src="./app.legacy.js?v=20251105"></script>
</body>
</html>


<!doctype html>
<html lang="es">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><title>Cocina · Seven de Burgers</title><link rel="stylesheet" href="../assets/styles.css"></head>
<body>
  <div class="header"><div class="logo">🍔 Seven de Burgers <span class="badge">Cocina</span></div><div class="row"><a class="btn secondary" href="../login/index.html">Login</a></div></div>
  <div class="container">
    <div class="columns"><section><h3>Pendientes</h3><div id="list-pending"></div></section><section><h3>En preparación</h3><div id="list-progress"></div></section><section><h3>Listos</h3><div id="list-ready"></div></section></div>
  </div>
  <script type="module">
    import {subscribeOrders, setStatus, archiveDelivered, Status} from '../shared/state.smart.js';
    const listPending=document.getElementById('list-pending'), listProgress=document.getElementById('list-progress'), listReady=document.getElementById('list-ready');
    const pillClass=s=>({pending:'pill--pending',in_progress:'pill--in_progress',ready:'pill--ready'})[s]||'pill--pending';
    const pillText=s=>({pending:'Pendiente',in_progress:'En preparación',ready:'Listo'})[s]||s;
    function card(o){
      const ing=Array.isArray(o.ingredientesFinales)?o.ingredientesFinales.join(' · '):'—';
      const ad=(o.aderezos||[]).join(', ')||'—'; const ex=(o.extras||[]).join(', ')||'—';
      return `<article class="k-card" data-id="${o.id}">
        <header><strong>${o.customer||'Cliente'}</strong> · Mesa ${o.table||'-'} <span class="pill ${pillClass(o.status)}">${pillText(o.status)}</span></header>
        <div class="small"><b>${o.burgerName}</b> × ${o.qty||1}</div>
        <div class="small"><b>Ingredientes:</b> ${ing}</div>
        <div class="small"><b>Aderezos extra:</b> ${ad}</div>
        <div class="small"><b>Extras:</b> ${ex}</div>
        <div class="small"><b>Notas:</b> ${o.notes||'—'}</div>
        <div class="k-actions">
          ${o.status==='pending' ? '<button class="k-btn k-primary" data-a="take">Tomar</button>' : ''}
          ${o.status==='in_progress' ? '<button class="k-btn k-primary" data-a="ready">Listo</button>' : ''}
          ${o.status==='ready' ? '<button class="k-btn k-success" data-a="deliver">Despachado</button>' : ''}
        </div>
      </article>`;
    }
    function render(list){
      const p=list.filter(o=>o.status===Status.PENDING);
      const ip=list.filter(o=>o.status===Status.IN_PROGRESS);
      const r=list.filter(o=>o.status===Status.READY);
      listPending.innerHTML = p.map(card).join('') || '<div class="empty">Sin pendientes</div>';
      listProgress.innerHTML = ip.map(card).join('') || '<div class="empty">Sin preparación</div>';
      listReady.innerHTML = r.map(card).join('') || '<div class="empty">Sin listos</div>';
    }
    subscribeOrders(render);
    document.addEventListener('click', async (e)=>{
      const btn=e.target.closest('button[data-a]'); if(!btn) return;
      const id=btn.closest('.k-card')?.dataset.id; if(!id) return; const a=btn.dataset.a;
      if(a==='take') await setStatus(id, Status.IN_PROGRESS);
      if(a==='ready') await setStatus(id, Status.READY);
      if(a==='deliver') await archiveDelivered(id);
    });
  </script>
  <footer>Backend: <span id="bk">—</span></footer>
  <script type="module">import {backendName} from '../shared/state.smart.js'; document.getElementById('bk').textContent=backendName;</script>
</body></html>

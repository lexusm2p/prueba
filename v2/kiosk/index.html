<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Seven â€” Kiosko V2 (test)</title>
  <meta name="robots" content="noindex,nofollow">
  <link rel="stylesheet" href="../shared/styles.css">
  <link rel="stylesheet" href="../shared/styles.legacy.css">
  <style>
    body{background:#0f1422;color:#fff8e6;font-family:system-ui,Arial}
    #app{padding:16px;font-size:20px}
    .err{position:fixed;left:8px;bottom:8px;background:#000a;color:#ffb;padding:8px;border:1px solid #834;max-width:92vw;white-space:pre-wrap;z-index:99999}
    .badge{position:fixed;right:8px;bottom:8px;background:#111a;border:1px solid #345;color:#9fe;padding:4px 8px;border-radius:6px;font:12px/1.2 system-ui}
  </style>
</head>
<body data-theme="base">
  <script>
  // ðŸ”’ ProtecciÃ³n temprana para _freezeSettings
  if (typeof window !== 'undefined' && !window._freezeSettings) {
    window._freezeSettings = (s) => Object.freeze({ ...(s || {}) });
  }
</script>
  <div id="app">Cargando Kiosko V2â€¦</div>

  <script>
    // 0) Flags de modo visibles para TODOS los mÃ³dulos ðŸ‘ˆ
    const qs = new URLSearchParams(location.search);
    const mode = (qs.get('mode') || 'online').toLowerCase();
    window.MODE = {
      OFFLINE: mode === 'offline',
      READONLY: qs.get('ro') === '1',
      LEGACY: qs.get('legacy') === '1'
    };
    // insignia de modo
    const badge = document.createElement('div');
    badge.className = 'badge';
    badge.textContent = `mode=${mode}${window.MODE.READONLY?' Â· RO':''}${window.MODE.LEGACY?' Â· LEGACY':''}`;
    document.body.appendChild(badge);
  </script>

  <!-- 1) Guard del tema: define window._freezeSettings si no existe ðŸ‘ˆ -->
  <script type="module" src="../shared/theme-guard.js"></script>

  <script type="module">
    // 2) Overlay de errores robusto ðŸ‘ˆ
    const showErr = (label, val) => {
      const b = document.createElement('div'); b.className='err';
      let msg = '';
      if (val && typeof val === 'object') {
        msg = val.message || JSON.stringify(val);
      } else {
        msg = String(val);
      }
      b.textContent = `[${label}] ${msg}`;
      document.body.appendChild(b);
    };
    window.addEventListener('error', (e)=> showErr('Error', e.message || e.error));
    window.addEventListener('unhandledrejection', (e)=> showErr('Promise', (e.reason && e.reason.message) || e.reason));

    // 3) Confirmar que corre
    document.getElementById('app').textContent = 'Kiosko V2 base OK â€” cargando mÃ³dulosâ€¦';

    // 4) Flags/legacy
    import './config.js';
    try { await import('./legacy.js'); } catch(_) {}

    // 5) Cargar Firebase (opcional si db.js ya lo importa)
    // Si quieres evitar doble import, comenta la lÃ­nea siguiente:
    await import('../shared/firebase.js');

    // 6) Cargar la app real
    await import('./app.js');
  </script>
</body>
</html>

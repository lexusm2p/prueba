<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Seven — Kiosko V2 (test)</title>
  <meta name="robots" content="noindex,nofollow"/>

  <!-- Hoja de estilos principal -->
  <link rel="stylesheet" href="../shared/styles.css"/>

  <!-- Respaldo ligero por si faltan algunas utilidades en styles.css -->
  <style>
    :root{
      --bg:#0f1422;
      --panel:#131b2d;
      --panel1:#10182b;
      --accent:#ff9f0a;
      --text:#fff8e6;
      --stroke:rgba(255,255,255,.12);
      --muted:#a9b8d3;
      --font-display:"Press Start 2P", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    *{ box-sizing:border-box; }

    body{
      background:var(--bg);
      color:var(--text);
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin:0;
      overflow-x:hidden;
    }

    .muted{ color:var(--muted); }
    .row{ display:flex; align-items:center; gap:8px; }

    .btn{
      cursor:pointer;
      border:2px solid var(--accent);
      background:transparent;
      color:var(--text);
      padding:10px 14px;
      border-radius:10px;
      font-size:14px;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn.ok{ background:var(--accent); color:#000; }
    .btn.ghost{ border-color:var(--stroke); }
    .btn.small{ padding:8px 12px; font-size:13px; }
    .btn.tiny{ padding:6px 10px; font-size:11px; }
    .danger{ border-color:#ff5858; color:#ff9b9b; }

    /* Layout principal */
    header.header{
      position:sticky;
      top:0;
      z-index:30;
      background:rgba(5,8,20,.96);
      backdrop-filter:blur(6px);
    }
    header .brand{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      cursor:pointer;
    }
    header .brand .dot{
      width:10px;
      height:10px;
      border-radius:50%;
      background:var(--accent);
    }
    main.container{
      padding:8px 14px 96px; /* espacio para la barra del carrito */
    }

    /* Barra superior HH + ETA */
    .topbar{
      display:flex;
      align-items:center;
      gap:10px;
      padding:6px 12px 10px;
      flex-wrap:wrap;
    }
    #hhPill{
      display:flex;
      align-items:center;
      gap:8px;
      border:1px solid var(--stroke);
      background:rgba(16,24,45,.9);
      padding:6px 10px;
      border-radius:999px;
      font-size:11px;
    }
    #hhPill.on{ border-color:var(--accent); }
    #hhText{ font-weight:700; }
    .eta{ margin-left:auto; white-space:nowrap; font-size:11px; }
    .eta .chip{
      border:1px solid var(--stroke);
      padding:6px 10px;
      border-radius:999px;
    }

    /* Tabs */
    #tabsBar{
      display:flex;
      justify-content:center;
      gap:10px;
      margin:8px 0 6px;
      flex-wrap:wrap;
    }
    .tab{
      background:var(--panel1);
      border:2px solid var(--accent);
      border-radius:10px;
      color:var(--text);
      font-family:var(--font-display);
      font-size:11px;
      padding:10px 14px;
      cursor:pointer;
    }
    .tab.is-active{
      background:var(--accent);
      color:#000;
    }

    /* Grid de productos */
    #cards.grid{
      display:grid;
      gap:16px;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    }
    .card{
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .card h3{
      margin:0 0 4px;
      font-family:var(--font-display);
      font-size:14px;
    }
    .card .media{
      display:grid;
      place-items:center;
      min-height:110px;
      background:rgba(9,13,24,.96);
      border-radius:12px;
      margin-bottom:4px;
    }
    .card .icon-img{
      max-width:180px;
      max-height:120px;
      display:block;
    }

    /* Chips / acordeón ingredientes */
    .k-chips{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin:2px 0;
    }
    .k-chip{
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:3px 7px;
      font-size:10px;
    }
    details.ing-acc summary{
      cursor:pointer;
      list-style:none;
      outline:none;
    }
    details.ing-acc summary::-webkit-details-marker{ display:none; }

    /* Modal base (fallback si el CSS global no define estilos) */
    .modal{
      display:none;
      position:fixed;
      inset:0;
      z-index:1000;
      place-items:center;
      background:rgba(0,0,0,.4);
      backdrop-filter:blur(2px);
      padding:12px;
    }
    .modal.open{ display:grid; }
    .modal-card{
      width:min(880px, 100%);
      max-height:90dvh;
      display:flex;
      flex-direction:column;
      background:var(--panel);
      border:1px solid var(--stroke);
      border-radius:14px;
    }
    .modal-head,
    .modal-foot{
      padding:10px 12px;
      border-bottom:1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .modal-foot{
      border-bottom:none;
      border-top:1px solid var(--stroke);
    }
    .modal-body{
      padding:10px 12px;
      overflow:auto;
    }
    .field{
      margin:8px 0;
      display:block;
      font-size:13px;
    }
    .field > label{
      display:block;
      font-weight:600;
      margin-bottom:4px;
      font-size:12px;
    }
    .total-bar{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:flex-end;
      font-size:13px;
    }
    .total{ font-size:18px; }

    /* Barra de carrito fija */
    #cartBar{
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      z-index:40;
      display:none;
      align-items:center;
      justify-content:center;
      gap:12px;
      padding:10px 12px;
      background:rgba(5,8,20,.97);
      backdrop-filter:blur(6px);
      border-top:1px solid var(--stroke);
    }
    #openCart.btn{ border-radius:999px; }

    /* Utilitarios */
    #app{ padding:8px 14px; font-size:13px; }
    .err{
      position:fixed;
      left:8px;
      bottom:8px;
      background:#000a;
      color:#ffb;
      padding:8px;
      border:1px solid #834;
      max-width:92vw;
      white-space:pre-wrap;
      z-index:99999;
      font-size:11px;
    }
    .badge{
      position:fixed;
      right:8px;
      bottom:8px;
      background:#111a;
      border:1px solid #345;
      color:#9fe;
      padding:4px 8px;
      border-radius:6px;
      font:11px/1.2 system-ui;
      z-index:9999;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:4px 8px;
      font-size:10px;
      line-height:1;
      background:rgba(16,24,45,.96);
    }
    .k-card{
      background:rgba(11,17,30,.96);
      border:1px solid var(--stroke);
      border-radius:12px;
      padding:10px;
    }
    .price{ font-weight:700; }
    .small{ font-size:11px; }
    .mono{
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }
  </style>
</head>
<body data-theme="base">
  <!-- Guard mínimo para _freezeSettings muy temprano -->
  <script>
    if (typeof window !== 'undefined' && !window._freezeSettings) {
      window._freezeSettings = (s) => Object.freeze({ ...(s||{}) });
    }
  </script>

  <!-- Encabezado -->
  <header class="header">
    <div class="brand" onclick="location.reload()">
      <div class="dot"></div>
      <div>
        <div>Seven de Burgers</div>
        <div class="title-sub small">Kiosko V2 (test)</div>
      </div>
    </div>

    <div class="topbar">
      <div id="hhPill">
        <span id="hhText" class="small">HH OFF</span>
        <span id="hhMsg" class="muted small"></span>
      </div>
      <div class="eta">
        <span class="chip">ETA: <b data-eta-text>7–10 min</b></span>
      </div>
    </div>
  </header>

  <!-- Tabs -->
  <nav id="tabsBar" class="tabs">
    <button id="btnMinis" class="btn tab is-active">Minis</button>
    <button id="btnBig" class="btn tab">Big</button>
    <!-- Tabs de Papas / Bebidas se agregan dinámicamente desde app.js si el menú las trae -->
  </nav>

  <!-- Contenido principal -->
  <main class="container">
    <div id="app" class="muted">App.js cargado — iniciando módulos…</div>
    <section id="cards" class="grid" aria-live="polite"></section>
  </main>

  <!-- Barra de carrito -->
  <div id="cartBar">
    <button id="openCart" class="btn ok small">
      <span id="cartCount">0</span> artículos · <span id="cartBarTotal">$0</span> — Ver carrito
    </button>
  </div>

  <!-- Modal personalización -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="mTitle">
      <div class="modal-head">
        <strong id="mTitle">Personalizar</strong>
        <button id="mClose" class="btn small ghost" aria-label="Cerrar">×</button>
      </div>
      <div id="mBody" class="modal-body"></div>
      <div class="modal-foot">
        <div class="total-bar">
          <span class="muted">Total</span>
          <strong id="mTotal" class="total">$0</strong>
          <button id="mAdd" class="btn ok">Agregar al carrito</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal carrito -->
  <div id="cartModal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="cTitle">
      <div class="modal-head">
        <strong id="cTitle">Tu pedido</strong>
        <button id="cartClose" class="btn small ghost" aria-label="Cerrar">×</button>
      </div>
      <div id="cartBody" class="modal-body"></div>
      <div class="modal-foot">
        <div class="total-bar">
          <span class="muted">Total</span>
          <strong id="cartTotalFooter" class="total">$0</strong>
          <button id="cartConfirm" class="btn ok">Confirmar pedido</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Badge de modo (online/offline/legacy) -->
  <script>
    (function(){
      const qs = new URLSearchParams(location.search);
      const mode = (qs.get('mode') || 'online').toLowerCase();
      window.MODE = {
        OFFLINE:  mode === 'offline',
        READONLY: qs.get('ro') === '1',
        LEGACY:   qs.get('legacy') === '1'
      };
      const badge = document.createElement('div');
      badge.className = 'badge';
      badge.textContent =
        `mode=${mode}` +
        (window.MODE.READONLY ? ' · RO' : '') +
        (window.MODE.LEGACY   ? ' · LEGACY' : '');
      document.body.appendChild(badge);
    })();
  </script>

  <!-- Loader progresivo único -->
  <script type="module">
    (async () => {
      const showErr = (label, val) => {
        try{
          const b = document.createElement('div');
          b.className = 'err';
          const msg = (val && typeof val === 'object')
            ? (val.message || JSON.stringify(val))
            : String(val);
          b.textContent = `[${label}] ${msg}`;
          document.body.appendChild(b);
        }catch(_){}
      };

      window.addEventListener('error', e => {
        showErr('Error', e.message || e.error || 'unknown');
      });
      window.addEventListener('unhandledrejection', e => {
        showErr('Promise', (e.reason && e.reason.message) || e.reason || 'rejected');
      });

      // Guard de tema opcional (si no existe, se ignora)
      try {
        await import('../shared/theme-guard.js?v=20251108');
      } catch {}

      // Config opcional
      try {
        await import('./config.js?v=20251108');
      } catch (e) {
        console.warn('[kiosk] config.js no cargó (opcional)', e);
      }

      // Legacy opcional (limpieza visual si hay restos viejos)
      try {
        await import('./legacy.js?v=20251108');
      } catch (e) {
        console.info('[kiosk] sin legacy.js (ok)');
      }

      // Limpia restos legacy si algún HTML viejo los trae
      [
        '#filters','#optionsPane','#preferences','#legacy','.legacy',
        '.kiosk-form','#formOptions','#formExtras','.right-panel',
        '.left-panel'
      ].forEach(sel => {
        document.querySelectorAll(sel).forEach(n => n.remove());
      });

      // App real — asegúrate de que la versión coincida con tus imports internos
      await import('./app.js?v=20251108');
    })();
  </script>
</body>
</html>
